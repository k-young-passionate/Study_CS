## 4. 이 책의 학습 환경

- mac에서 설치

```bash
$ brew install minikube
$ minikube start
```

## 5. 도커 커맨드 치트 시트

```sh
# container 환경 표시

$ docker version
$ docker info

# 이미지 빌드

$ docker build -t {repo}:{tag}
$ docker image ls # local image 목록
$ docker image rm {image} # local image 삭제
$ docker image prune -a # local image 일괄 삭제

# 이미지 이동/공유

$ docker pull {remote repo}[:{tag}] # 원격 repo에서 image pull
$ docker tag {image}[:{tag}] # local image 태깅
$ docker login {registry_server_url}
$ docker push {remote repo}[:{tag}]
$ docker save -o {file name} {image} # 이미지를 아카이브 형식 파일로 기록
$ docker load -i {file name} # 아카이브 형식 파일을 repo에 등록
$ docker export <container 명 | Id> -o {file name} # container를 tar 형식 파일로 기록
$ docker import {file name} {repo}[:{tag}] # 파일로 저장된 이미지를 repo에 입력

# container 실행

$ docker run --rm -it {image} {command} # 대화형 커멘드 실행
$ docker run -d -p {host port}:{container port} {image} # 백그라운드로 컨테이너 실행
$ docker run -d --name {container} -p {host port}:{container port} {image}
$ docker run -v {host path}:{container path} -d -p {host port}:{container port} {image}
$ docker exec -it {container} sh # 대화형 shell 실행
$ docker ps
$ docker ps -a
$ docker stop
$ docker kill
$ docker rm
$ docker rm `docker ps -a -q`
$ docker commit {container} {repo}[:{tag}]

# debug

$ docker logs {container}
$ docker logs -f {container} # 실시간
$ docker ps -a
$ docker inspect {container} # 상세 정보
$ docker stats # 실행 상태 실시간
$ docker attach --sig-proxy=false {container} # 컨테이너 표준 출력
$ docker pause {container}
$ docker unpause {container}
$ docker start -a {container}

# network

$ docker network create {network}
$ docker network ls
$ docker network rm {network}
$ docker network prune # 미사용 네트워크 삭제

# Persistent Volume 관련

$ docker volume create {volume}
$ docker volume ls
$ docker volume rm {volume}
$ docker volume prune

# docker compose

$ docker-compose up -d # docker-compose.yml 이용 복수의 컨테이너 기동
$ docker-compose ps
$ docker-compose down
$ docker-compose down --rmi all
```

## 6. kubectl 커맨드 치트 시트

```sh
# command

$ kubectl get # object 목록
$ kubectl describe # get 보다 자세
$ kubectl apply -f {manifest} # 생성/변경
$ kubectl create -f {file name} # 생성/에러
$ kubectl delete
$ kubectl config get-contexts # context 목록 출력
$ kubectl config use-context {context} # context 목록 선택
$ kubectl exec -it <pod> [-c {container name}] <command> # 대화형으로 command 실행
$ kubectl run {name} --image={image} # pod 실행
$ kubectl logs
```

### resource type

#### pod

- `pod` `po`
- `poddisruptionbudget` `pdb`: pod의 최소 갯수


#### service

- `service` `svc`
- `endpoints` `ep`: ip 주소 & port
- `ingress` `ing`: tls, session, url mapping


#### controller

- `deployment` `deploy`
- `replicaset` `rs`
- `statefulset` `sts`
- `job`: batch
- `cronjob`
- `daemonset` `ds`
- `horizontalpodautoscaler` `hpa`: 워크로드에 따라 pod 수 조절


#### volume

- `persistentvolume` `pv`: storage 관리
- `persistentvolumeclain` `pvc`: 논리 볼륨의 provisionaing 요구
- `storageclass` `sc`: storage 종류


#### k8s cluster 구성

- `node` `no`
- `apiservice`: API 서비스
- `componentstatuses` `cs`: component 상태
- `controllerrevision`
- `event`

#### config

- `configmap` `cm`
- `secret`

#### namespace

- `namespace` `ns`

#### 역할 기반 access 제어 (RBAC)

- `serviceaccount` `sa`: 접근 권한 식별
- `role`: 일련의 권한
- `rolebinding`: `sa`와 `role` 바인딩
- `clusterrole`: K8s 전체에 유효한 role
- `clusterrolebinding`

#### 보안

- `certificatesigningrequest` `csr`: root 인증서 서명 요구
- `networkpolicies` `netpol`: `ns` 사이의 네트워크 접근 제어
- `podsecuritypolicies` `psp`: pod security 관련 항목의 기본값 설정


#### 자원 관리

- `limitrange` `limits`: cpu / memory 요구값 상한값
- `resourcequota` `quota`: `ns`별 CPU / 메모리 요구량 상한선


### 옵션

```sh
-n {namespace} # 조작 대상 ns 한정
--all-namespaces -A # 모든 ns 대상
-o=yaml # yaml 포맷으로 API 오브젝트 표시
-o=wide # 추가정보 표시
-o=custom-columns=<spec> # 항목을 지정해서 목록 표시
-o=custom-columns-file=<file>
-o=jsonpath=<template> # jsonpath에 일치하는 목록 표시
-o=jsonpath-file=<filename>
```




